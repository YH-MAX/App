# WaterAPP Backend â€“ API Documentation

**Backend:** Spring Boot (Java)  
**Auth:** JWT  
**Base Path:** `/api/*`

This document contains the complete API reference for Waterapp, including:  
- User Authentication  
- Water Sensor Data  
- Pollution Reports  
- Community Forum  
- Auto Alert System  
- Global Status Codes & Headers  

## Table of Contents
- [1. User API â€” /api/users](#1-user-api)
- [2. Sensor API â€” /api/sensor](#2-sensor-api)
- [3. Pollution Report API â€” /api/reports](#3-pollution-report-api)
- [4. Community API â€” /api/community](#4-community-api)
- [5. Alert API â€” /api/alerts](#5-alert-api)
- [6. Global Headers](#6-global-headers)
- [7. Global Status Codes](#7-global-status-codes)
- [8. Base URL](#8-base-url)

## 1. User API â€” /api/users

### 1.1 Register
**POST** `/api/users/register`  
Create a new user.

**Request**
```json
{
  "name": "Yan Han",
  "email": "yan@example.com",
  "password": "123456",
  "role": "USER"
}

Response
JSON{
  "id": 1,
  "name": "Yan Han",
  "email": "yan@example.com",
  "role": "USER",
  "createdAt": "2025-01-02T10:00:00"
}
1.2 Login
POST /api/users/login
Authenticate user and return JWT.
Request
JSON{
  "email": "yan@example.com",
  "password": "123456"
}
Response
JSON{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.xxxx",
  "email": "yan@example.com",
  "message": "Login successful!"
}
2. Sensor API â€” /api/sensor
2.1 Upload Sensor Data ðŸ”’
POST /api/sensor/uploadâ€ƒ(JWT required)
Request
JSON{
  "ph": 6.9,
  "temperature": 27.8,
  "turbidity": 4.1,
  "location": "KK3"
}
Response
JSON{
  "id": 15,
  "email": "user@example.com",
  "ph": 6.9,
  "temperature": 27.8,
  "turbidity": 4.1,
  "location": "KK3",
  "timestamp": "2025-01-02T10:12:30"
}
2.2 Get Latest Sensor Data ðŸ”’
GET /api/sensor/me/latest
Response
JSON{
  "ph": 7.1,
  "temperature": 26.4,
  "turbidity": 3.2,
  "location": "KK5",
  "timestamp": "2025-01-02T11:00:00",
  "status": "GOOD"
}
2.3 Get Data by Date Range ðŸ”’
GET /api/sensor/me/range?from=2025-01-01T00:00:00&to=2025-01-02T23:59:59
Response
JSON[
  {
    "ph": 7.0,
    "temperature": 26.0,
    "turbidity": 3.9,
    "location": "KK12",
    "timestamp": "2025-01-01T11:00:00",
    "status": "FAIR"
  }
]
2.4 Summary ðŸ”’
GET /api/sensor/me/summary?from=2025-01-01&to=2025-01-31
Response
JSON{
  "avgPh": 7.05,
  "avgTemperature": 26.7,
  "avgTurbidity": 3.8,
  "overallStatus": "FAIR",
  "count": 12
}
3. Pollution Report API â€” /api/reports
3.1 Submit Report ðŸ”’
POST /api/reports
Request
JSON{
  "description": "Water smells strange near KK11.",
  "photoUrl": "https://example.com/pic.jpg",
  "location": "KK11"
}
Response
JSON{
  "message": "Report submitted successfully.",
  "id": 12,
  "description": "Water smells strange near KK11.",
  "photoUrl": "https://example.com/pic.jpg",
  "location": "KK11",
  "status": "PENDING",
  "createdAt": "2025-01-01T10:00:00",
  "autoGenerated": false
}
3.2 My Reports ðŸ”’
GET /api/reports/me
3.3 All Reports
GET /api/reportsâ€ƒ(Admin or public depending on role)
3.4 Update Status (Admin only)
PUT /api/reports/{id}/status
Request
JSON{
  "status": "RESOLVED",
  "adminComment": "Issue fixed."
}
4. Community API â€” /api/community
4.1 Create Post ðŸ”’
POST /api/community/posts
Request
JSON{
  "content": "Water looks cloudy.",
  "photoUrl": "https://example.com/img.jpg",
  "location": "UM Lake",
  "ph": 6.8,
  "temperature": 28.4,
  "turbidity": 3.5,
  "type": "report"
}
4.2 Get All Posts
GET /api/community/postsâ€ƒ(optional ?location=KK5)
4.3 Get Post By ID
GET /api/community/posts/{id}
4.4 Like Post ðŸ”’
POST /api/community/posts/{postId}/like
4.5 Reply to Post ðŸ”’
POST /api/community/posts/{postId}/replies
Request
JSON{
  "content": "Agree, turbidity is high.",
  "expertReply": false
}
4.6 Get Replies
GET /api/community/posts/{postId}/replies
5. Alert API â€” /api/alerts
5.1 Evaluate Water Reading
POST /api/alerts/evaluate
Request
JSON{
  "ph": 7.2,
  "temperature": 25.5,
  "turbidity": 3.8
}
Response
JSON{
  "alert": true,
  "severity": "HIGH",
  "message": "Dangerous contamination detected!"
}
6. Global Headers
For all JWT-protected endpoints:
textAuthorization: Bearer <your-jwt-token>
Content-Type: application/json
7. Global Status Codes
Code,Meaning
200,OK
201,Created
400,Bad Request
401,Unauthorized
403,Forbidden
404,Not Found
500,Internal Server Error

8. Base URL

Local Development:http://localhost:8080
Production (example):https://smartwater.yourdomain.com

ðŸ”’ = Requires valid JWT token
