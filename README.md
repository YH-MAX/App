# WaterAPP Backend — API Documentation (v1.0)

Backend: Spring Boot (Java)  
Auth: JWT  
Base Path: `/api/*`

It documents endpoints for user authentication, sensor data, pollution reports, community features, and alerts.

Table of Contents
- User API (/api/users)
- Sensor API (/api/sensor)
- Pollution Report API (/api/reports)
- Community API (/api/community)
- Alert API (/api/alerts)
- Global Headers
- Global Status Codes
- Base URL
- Examples

---

## 1. User API — /api/users

1.1 Register  
POST /api/users/register  
Request body:
```json
{
  "name": "Yan Han",
  "email": "yan@example.com",
  "password": "123456",
  "role": "USER"
}
```
Response (201 Created):
```json
{
  "id": 1,
  "name": "Yan Han",
  "email": "yan@example.com",
  "role": "USER",
  "createdAt": "2025-01-02T10:00:00"
}
```

1.2 Login  
POST /api/users/login  
Request body:
```json
{
  "email": "yan@example.com",
  "password": "123456"
}
```
Response:
```json
{
  "token": "JWT_TOKEN_HERE",
  "email": "yan@example.com",
  "message": "Login successful!"
}
```

---

## 2. Sensor API — /api/sensor

2.1 Upload Sensor Data  
POST /api/sensor/upload  
Requires JWT (Authorization: Bearer <token>)  
Request body:
```json
{
  "ph": 6.9,
  "temperature": 27.8,
  "turbidity": 4.1,
  "location": "KK3"
}
```
Response:
```json
{
  "id": 15,
  "email": "user@example.com",
  "ph": 6.9,
  "temperature": 27.8,
  "turbidity": 4.1,
  "location": "KK3",
  "timestamp": "2025-01-02T10:12:30"
}
```

2.2 Get Latest Sensor Data (current user)  
GET /api/sensor/me/latest  
Response:
```json
{
  "ph": 7.1,
  "temperature": 26.4,
  "turbidity": 3.2,
  "location": "KK5",
  "timestamp": "2025-01-02T11:00:00",
  "status": "GOOD"
}
```

2.3 Get Data by Date Range  
GET /api/sensor/me/range?from=...&to=...  
Response: Array of sensor readings.

2.4 Summary  
GET /api/sensor/me/summary?from=...&to=...  
Response:
```json
{
  "avgPh": 7.05,
  "avgTemperature": 26.7,
  "avgTurbidity": 3.8,
  "overallStatus": "FAIR",
  "count": 12
}
```

---

## 3. Pollution Report API — /api/reports

3.1 Submit Report  
POST /api/reports  
Requires JWT  
Request body:
```json
{
  "description": "Water smells strange near KK11.",
  "photoUrl": "https://example.com/pic.jpg",
  "location": "KK11"
}
```
Response:
```json
{
  "message": "Report submitted successfully.",
  "id": 12,
  "description": "Water smells strange near KK11.",
  "photoUrl": "https://example.com/pic.jpg",
  "location": "KK11",
  "status": "PENDING",
  "createdAt": "2025-01-01T10:00:00",
  "autoGenerated": false,
  "adminComment": null,
  "resolvedAt": null
}
```

3.2 My Reports  
GET /api/reports/me

3.3 All Reports  
GET /api/reports

3.4 Update Status (Admin)  
PUT /api/reports/{id}/status  
Request body:
```json
{
  "status": "RESOLVED",
  "adminComment": "Issue fixed."
}
```

---

## 4. Community API — /api/community

4.1 Create Post  
POST /api/community/posts  
Requires JWT  
Request body:
```json
{
  "content": "Water looks cloudy.",
  "photoUrl": "https://example.com/img.jpg",
  "location": "UM Lake",
  "ph": 6.8,
  "temperature": 28.4,
  "turbidity": 3.5,
  "type": "report"
}
```

4.2 Get All Posts  
GET /api/community/posts  
Optional query: ?location=KK5

4.3 Get Post By ID  
GET /api/community/posts/{id}

4.4 Like Post  
POST /api/community/posts/{postId}/like

4.5 Reply to Post  
POST /api/community/posts/{postId}/replies  
Requires JWT  
Request body:
```json
{
  "content": "Agree, turbidity is high.",
  "expertReply": false
}
```

4.6 Get Replies  
GET /api/community/posts/{postId}/replies

---

## 5. Alert API — /api/alerts

5.1 Evaluate Water Reading  
POST /api/alerts/evaluate  
JWT optional  
If severity is HIGH, a pollution report will be created automatically.

Request body:
```json
{
  "ph": 7.2,
  "temperature": 25.5,
  "turbidity": 3.8
}
```
Response:
```json
{
  "alert": true,
  "severity": "HIGH",
  "message": "Dangerous contamination detected!"
}
```

---

## 6. Global Headers

For JWT-protected endpoints:
- Authorization: Bearer <token>
- Content-Type: application/json

---

## 7. Global Status Codes

- 200 OK
- 201 Created
- 400 Bad Request
- 401 Unauthorized
- 403 Forbidden
- 404 Not Found
- 500 Server Error

---

## 8. Base URL

Local development:
http://localhost:8080

Production example:
https://smartwater.yourdomain.com

---

## Examples (curl)

Login and get token:
```bash
curl -X POST http://localhost:8080/api/users/login \
  -H "Content-Type: application/json" \
  -d '{"email":"yan@example.com","password":"123456"}'
```

Upload sensor data (with token):
```bash
curl -X POST http://localhost:8080/api/sensor/upload \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{"ph":6.9,"temperature":27.8,"turbidity":4.1,"location":"KK3"}'
```
